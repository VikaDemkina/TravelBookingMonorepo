# Руководство по миграции на монорепозиторий

Это руководство описывает процесс миграции с монолитного проекта на структуру монорепозитория с использованием Turborepo.

## Шаги миграции

### 1. Анализ исходной структуры

Перед миграцией был проведен анализ исходной структуры проекта:

- Frontend: Next.js приложение с компонентами, страницами и интеграцией с API
- База данных: PostgreSQL с Prisma ORM
- Общие компоненты и типы

### 2. Определение пакетов

На основе анализа были определены следующие пакеты для монорепозитория:

- **frontend**: UI/UX часть приложения на Next.js
- **backend**: API серверная часть на Express.js
- **shared**: Общие типы и компоненты

### 3. Создание структуры монорепозитория

1. Создан новый репозиторий `TravelBookingMonorepo`
2. Настроена базовая структура папок:
   ```
   packages/
     frontend/
     backend/
     shared/
   ```
3. Настроены корневой package.json с workspaces и turbo.json

### 4. Миграция кода

#### Frontend

1. Перенос кода из `src` в `packages/frontend/src`
2. Адаптация путей импорта
3. Настройка использования общих типов из пакета `shared`

#### Backend

1. Выделение серверной части в отдельный пакет
2. Перенос Prisma схемы и миграций
3. Настройка Express сервера для API

#### Shared

1. Выделение общих типов данных
2. Миграция общих компонентов и утилит

### 5. Настройка CI/CD

1. Настройка GitHub Actions для CI процессов:
   - Линтинг
   - Тестирование
   - Сборка

2. Настройка CD для автоматического деплоя:
   - Сборка артефактов
   - Деплой в тестовую среду

3. Настройка сбора метрик для анализа эффективности

## Проблемы и решения при миграции

### Разрешение зависимостей

**Проблема**: Конфликты версий зависимостей между пакетами.

**Решение**: 
- Использование единой версии общих зависимостей через hoisting
- Использование peerDependencies для shared пакета

### Типизация между пакетами

**Проблема**: Обеспечение типизации между разными пакетами.

**Решение**:
- Создание пакета shared с общими интерфейсами
- Настройка references в tsconfig.json

### Сборка зависимых пакетов

**Проблема**: Необходимость правильного порядка сборки пакетов.

**Решение**:
- Использование Turborepo для управления зависимостями при сборке
- Настройка pipeline в turbo.json

## Преимущества после миграции

1. **Модульность**: Четкое разделение кода по пакетам
2. **Улучшенная параллелизация**: Ускорение сборки благодаря кешированию и параллельному выполнению
3. **CI/CD оптимизация**: Сборка и тестирование только измененных пакетов
4. **Улучшенное управление зависимостями**: Четкое определение зависимостей между пакетами
5. **Метрики производительности**: Сбор и анализ метрик для дальнейшей оптимизации

## Инструкции по дальнейшему улучшению

1. **Разделение команд разработки**: Разные команды могут работать над разными пакетами
2. **Версионирование**: Внедрение семантического версионирования для пакетов
3. **Расширение тестового покрытия**: Добавление e2e тестов
4. **Оптимизация Docker окружения**: Создание многоступенчатых Dockerfile для каждого пакета